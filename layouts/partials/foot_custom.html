<script defer src="//yihui.org/js/math-code.js"></script>
<script src="//cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script defer src="//yihui.org/js/center-img.js"></script>

<!-- littlefoot -->
<script src="//unpkg.com/littlefoot/dist/littlefoot.js" type="application/javascript" defer></script>

<!-- AOS -->
<script src="//unpkg.com/aos@2.3.4/dist/aos.js" defer></script>

<script defer>
document.addEventListener('DOMContentLoaded', function () {
  // 1) Initialise littlefoot after DOM is ready
  if (window.littlefoot && typeof littlefoot.default === 'function') {
    try { littlefoot.default(); } catch (e) { console.warn('littlefoot init failed:', e); }
  }

  // 2) Auto-decorate common content in BOTH article and main
  var targets = [
    'article p','article li','article img','article figure','article blockquote',
    'article h2','article h3','article h4',
    'main p','main li','main img','main figure','main blockquote',
    'main h2','main h3','main h4','main section'
  ];
  var els = document.querySelectorAll(targets.join(','));
  els.forEach(function (el) {
    if (!el.hasAttribute('data-aos')) el.setAttribute('data-aos', 'fade-up');
  });

  // 3) Respect reduced motion; animate once; steady defaults
  if (window.AOS && typeof AOS.init === 'function') {
    AOS.init({
      disable: function () {
        return window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      },
      once: true,
      offset: 80,
      duration: 600,
      easing: 'ease-in-out'
    });
  }

  // 4) If MathJax typesets after AOS init, refresh so positions are correct
  if (window.MathJax && MathJax.startup && MathJax.startup.promise) {
    MathJax.startup.promise.then(function () {
      if (window.AOS && typeof AOS.refreshHard === 'function') AOS.refreshHard();
    }).catch(function(){});
  }
});
</script>
